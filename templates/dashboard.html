<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How Hard Is It to HODL?</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        :root {
            --bitcoin-orange: #F7931A;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --background: #fefefe;
            --card-bg: #ffffff;
            --border-light: #e8ecef;
            --green: #27ae60;
            --red: #e74c3c;
            --yellow: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--background);
        }
        
        .essay-container { 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 40px 20px;
        }
        
        .hero {
            text-align: center;
            margin-bottom: 60px;
            padding: 40px 0;
        }
        
        .hero h1 {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 20px;
            line-height: 1.1;
        }
        
        .hero .subtitle {
            font-size: 1.3rem;
            color: var(--text-light);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .section {
            margin-bottom: 80px;
        }
        
        .section h2 {
            font-size: 2.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-dark);
        }
        
        .section h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-dark);
        }
        
        .section p {
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: var(--text-dark);
            line-height: 1.7;
        }
        
        .metric-formula {
            background: #f8f9fa;
            border-left: 4px solid var(--bitcoin-orange);
            padding: 20px;
            margin: 30px 0;
            border-radius: 0 8px 8px 0;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 1rem;
        }
        
        .current-stats {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin: 40px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid var(--border-light);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-top: 25px;
        }
        
        @media (min-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--bitcoin-orange);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 500;
        }
        
        .hardest-days {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin: 40px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid var(--border-light);
        }
        
        .day-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            margin: 10px 0;
            background: linear-gradient(135deg, #fff5f5 0%, #fef2f2 100%);
            border-radius: 8px;
            border-left: 4px solid var(--red);
            transition: all 0.2s ease;
        }
        
        .day-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.15);
        }
        
        .day-info {
            flex: 1;
        }
        
        .day-rank {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--red);
            margin-bottom: 4px;
        }
        
        .day-date {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 1rem;
            margin-bottom: 2px;
        }
        
        .day-price {
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .day-loss {
            text-align: right;
            color: var(--red);
            font-weight: 600;
        }
        
        .day-loss-pct {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 2px;
        }
        
        .day-loss-dollars {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .chart-container {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin: 40px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid var(--border-light);
        }
        
        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-dark);
        }
        
        .chart-description {
            font-size: 1rem;
            color: var(--text-light);
            margin-bottom: 25px;
            line-height: 1.6;
        }
        

        
        .insight-box {
            background: linear-gradient(120deg, #a8e6cf 0%, #dcedc1 100%);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            border-left: 4px solid var(--green);
        }
        
        .insight-box h4 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-dark);
        }
        
        .insight-box p {
            margin-bottom: 0;
            color: var(--text-dark);
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
            font-size: 1.1rem;
        }
        
        .error {
            color: var(--red);
            text-align: center;
            padding: 40px 20px;
            background: #fdf2f2;
            border-radius: 8px;
            border: 1px solid #fecaca;
            margin: 20px 0;
        }
        
        .update-time {
            text-align: center;
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-light);
        }
        
        .highlight {
            background: linear-gradient(120deg, #ffd89b 0%, #19547b 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .hero h1 { font-size: 2.5rem; }
            .hero .subtitle { font-size: 1.1rem; }
            .essay-container { padding: 20px 15px; }
            .stats-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        }
    </style>
</head>
<body>
    <div class="essay-container">
        <div id="loading" class="loading">
            Loading the emotional journey of Bitcoin...
        </div>
        
        <div id="error" class="error" style="display:none;"></div>
        
        <div id="content" style="display:none;">
            <div class="hero">
                <h1>How Hard Is It to <span class="highlight">HODL</span>?</h1>
                <p class="subtitle">An exploration of the emotional rollercoaster of holding Bitcoin through market cycles</p>
            </div>
            
            <div class="section">
                <p>Bitcoin's price chart is notorious for its dramatic peaks and valleys. But behind every red candle is a human story—someone staring at their portfolio, questioning their decisions, fighting the urge to sell.</p>
                
                <p>To understand the <em>emotional</em> difficulty of holding Bitcoin, I've developed a simple metric: <strong>how far is Bitcoin from its all-time high on any given day?</strong></p>
                
                <div class="metric-formula">
                    <strong>Distance from ATH = (Last ATH - Today's High) / Last ATH × 100</strong>
                    <br><br>
                    Where "Last ATH" is the most recent all-time high as of that day, not today's ATH looking backward.
                </div>
                
                <p>This tells us something crucial: on days when this number is high, HODLers are staring at serious paper losses. These are the days that test your conviction, the days you question everything.</p>
            </div>
            
            <div class="section">
                <h2>Right Now: How Hard Is It?</h2>
                <div class="current-stats">
                    <p>As of today, here's where Bitcoin stands in the emotional difficulty spectrum:</p>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="current-distance">-</div>
                            <div class="stat-label">Distance from ATH</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="current-price">-</div>
                            <div class="stat-label">Current Price</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="dollar-difference">-</div>
                            <div class="stat-label">Dollars Below ATH</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="percentile-rank">-</div>
                            <div class="stat-label">of days are harder to hold than today</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>The Hardest Days to HODL</h2>
                <p>Some days are harder than others. These were the five most emotionally challenging days in Bitcoin's history—the days when HODLers were truly tested:</p>
                
                <div class="hardest-days" id="hardest-days-container">
                    <div class="loading">Loading hardest days...</div>
                </div>
                
                <div class="insight-box" id="easy-days-insight" style="display:none;">
                    <h4>🎉 The Easy Days</h4>
                    <p id="easy-days-text">Loading...</p>
                </div>
            </div>
            
            <div class="section">
                <h2>The Emotional Journey Over Time</h2>
                <p>Here's Bitcoin's emotional difficulty over time. I've inverted the chart so that <strong>higher numbers mean it's easier to HODL</strong> (you're closer to ATH and feeling good), while lower numbers mean maximum emotional pain.</p>
                
                <div class="chart-container">
                    <div class="chart-title">HODL Difficulty Over Time (All Data)</div>
                    <div class="chart-description">Higher values = easier to hold (closer to ATH). Lower values = maximum emotional pain.</div>
                    <div id="historical-chart"></div>
                </div>
            </div>
            
            <div class="section">
                <h2>How Does It Feel to Hold Bitcoin?</h2>
                <p>This is where the story gets interesting. The distribution below shows something remarkable about the Bitcoin holding experience.</p>
                
                <div class="chart-container">
                    <div class="chart-title">Distribution of HODL Difficulty</div>
                    <div class="chart-description">How many days Bitcoin spent at each distance from its all-time high</div>
                    <div id="distribution-chart"></div>
                    
                    <div class="insight-box" id="distribution-insight" style="display:none;">
                        <h4>💡 The Uncomfortable Truth</h4>
                        <p id="distribution-insight-text">Loading...</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>Is It Easy to HODL Right Now?</h2>
                <p>This final chart answers a simple question: compared to all of Bitcoin's history, is today an easy day or a hard day to hold?</p>
                
                <div class="chart-container">
                    <div class="chart-title">Where Do We Stand?</div>
                    <div class="chart-description">If you're toward the left, congrats—today is relatively easy. Toward the right? You're being tested.</div>
                    <div id="cumulative-chart"></div>
                </div>
            </div>
            
            <div class="section">
                <h3>The Bottom Line</h3>
                <p>HODLing Bitcoin isn't just about believing in the technology or the monetary revolution. It's about psychology, emotion, and the very human challenge of watching numbers go up and down while the rest of the world tells you you're crazy.</p>
                
                <p>The data shows that for the majority of Bitcoin's existence, holders have been underwater from the last peak. That's the reality of being early to a revolutionary technology. The question isn't whether it's hard to HODL—it's whether you can handle the emotional rollercoaster when others cannot.</p>
            </div>
            
            <div class="update-time" id="update-time"></div>
        </div>
    </div>

    <script>
        let currentAnalysisData = null;
        let hardestDaysData = null;
        
        async function loadAllData() {
            try {
                // Load all data in parallel
                const [analysisResponse, hardestDaysResponse] = await Promise.all([
                    fetch('/api/current-analysis'),
                    fetch('/api/hardest-days')
                ]);
                
                const analysisData = await analysisResponse.json();
                const hardestDays = await hardestDaysResponse.json();
                
                if (!analysisData.success) throw new Error(analysisData.error);
                if (!hardestDays.success) throw new Error(hardestDays.error);
                
                currentAnalysisData = analysisData.data;
                hardestDaysData = hardestDays.data;
                
                // Update current stats
                updateCurrentStats();
                
                // Update hardest days
                updateHardestDays();
                
                // Update easy days insight
                updateEasyDaysInsight();
                
                // Load charts
                await Promise.all([
                    loadHistoricalChart(-1), // Always load all data
                    loadDistributionChart(),
                    loadCumulativeChart()
                ]);
                
                // Show content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
                // Update timestamp
                if (analysisData.last_updated) {
                    document.getElementById('update-time').textContent = 
                        'Last updated: ' + new Date(analysisData.last_updated).toLocaleString();
                }
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'Error loading data: ' + error.message;
            }
        }
        
        function updateCurrentStats() {
            if (!currentAnalysisData) return;
            
            // Format price to nearest thousand (e.g., 106k)
            const formatToK = (value) => {
                if (value >= 1000) {
                    return Math.round(value / 1000) + 'k';
                }
                return Math.round(value).toString();
            };
            
            document.getElementById('current-distance').textContent = 
                currentAnalysisData.current_distance_from_ath.toFixed(1) + '%';
            document.getElementById('current-price').textContent = 
                '$' + formatToK(currentAnalysisData.current_price);
            document.getElementById('dollar-difference').textContent = 
                '$' + formatToK(currentAnalysisData.dollar_difference_from_ath);
            document.getElementById('percentile-rank').textContent = 
                currentAnalysisData.percentile_rank.toFixed(0) + '%';
        }
        
        function updateHardestDays() {
            if (!hardestDaysData) return;
            
            const container = document.getElementById('hardest-days-container');
            container.innerHTML = '';
            
            hardestDaysData.hardest_days.forEach((day, index) => {
                const dayElement = document.createElement('div');
                dayElement.className = 'day-item';
                dayElement.innerHTML = `
                    <div class="day-info">
                        <div class="day-rank">#${index + 1}</div>
                        <div class="day-date">${new Date(day.date).toLocaleDateString()}</div>
                        <div class="day-price">Price: $${day.price.toLocaleString()}</div>
                    </div>
                    <div class="day-loss">
                        <div class="day-loss-pct">${day.distance_pct.toFixed(1)}% down</div>
                        <div class="day-loss-dollars">-$${day.dollar_loss.toLocaleString()}</div>
                    </div>
                `;
                container.appendChild(dayElement);
            });
        }
        
        function updateEasyDaysInsight() {
            if (!hardestDaysData) return;
            
            const insight = document.getElementById('easy-days-insight');
            const text = document.getElementById('easy-days-text');
            
            text.textContent = `Out of ${hardestDaysData.total_days.toLocaleString()} days in our dataset, only ${hardestDaysData.easy_days_count} days (${hardestDaysData.easy_days_percentage.toFixed(1)}%) were "easy" days where Bitcoin hit a new all-time high. On these days, HODLers felt like absolute geniuses.`;
            
            insight.style.display = 'block';
        }
        
        async function loadHistoricalChart(days) {
            try {
                const url = days === -1 ? '/api/historical-data?days=-1' : `/api/historical-data?days=${days}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    // Invert the distances so higher = easier to hold
                    const invertedDistances = data.data.distances.map(d => 100 - d);
                    
                    const trace = {
                        x: data.data.dates,
                        y: invertedDistances,
                        type: 'scatter',
                        mode: 'lines',
                        name: 'HODL Ease Score',
                        line: { color: '#F7931A', width: 2 },
                        fill: 'tonexty',
                        fillcolor: 'rgba(247, 147, 26, 0.1)',
                        hovertemplate: '<b>%{x}</b><br>% of ATH: %{y:.1f}%<extra></extra>'
                    };
                    
                    const layout = {
                        xaxis: { title: 'Date', showgrid: false },
                        yaxis: { 
                            title: 'HODL Ease Score (%)',
                            range: [0, 105],
                            showgrid: true,
                            gridcolor: '#f0f0f0'
                        },
                        margin: { t: 20, r: 20, b: 50, l: 60 },
                        plot_bgcolor: 'white',
                        paper_bgcolor: 'white',
                        font: { family: '-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif' }
                    };
                    
                    Plotly.newPlot('historical-chart', [trace], layout, {responsive: true, displayModeBar: false});
                }
            } catch (error) {
                console.error('Error loading historical chart:', error);
            }
        }
        
        async function loadDistributionChart() {
            try {
                const response = await fetch('/api/distribution-histogram');
                const data = await response.json();
                
                if (data.success) {
                    const trace = {
                        x: data.data.bin_centers,
                        y: data.data.counts,
                        type: 'bar',
                        name: 'Days',
                        marker: {
                            color: '#F7931A',
                            opacity: 0.8,
                            line: { color: '#E6851F', width: 1 }
                        }
                    };
                    
                    const maxCount = Math.max(...data.data.counts);
                    const mean = data.data.mean_distance;
                    const std = data.data.std_distance;
                    
                    // Add median line
                    const medianLine = {
                        x: [data.data.median_distance, data.data.median_distance],
                        y: [0, maxCount],
                        type: 'scatter',
                        mode: 'lines',
                        name: `Median: ${data.data.median_distance.toFixed(1)}%`,
                        line: { color: '#e74c3c', width: 3, dash: 'dash' }
                    };
                    
                    // Add mean line
                    const meanLine = {
                        x: [mean, mean],
                        y: [0, maxCount],
                        type: 'scatter',
                        mode: 'lines',
                        name: `Mean: ${mean.toFixed(1)}%`,
                        line: { color: '#2ecc71', width: 3, dash: 'dash' }
                    };
                    
                    // Add standard deviation lines
                    const stdLines = [];
                    
                    // +1 standard deviation
                    if (mean + std < Math.max(...data.data.bin_centers)) {
                        stdLines.push({
                            x: [mean + std, mean + std],
                            y: [0, maxCount],
                            type: 'scatter',
                            mode: 'lines',
                            name: `+1σ: ${(mean + std).toFixed(1)}%`,
                            line: { color: '#9b59b6', width: 2, dash: 'dot' }
                        });
                    }
                    
                    // -1 standard deviation (if positive)
                    if (mean - std > 0) {
                        stdLines.push({
                            x: [mean - std, mean - std],
                            y: [0, maxCount],
                            type: 'scatter',
                            mode: 'lines',
                            name: `-1σ: ${(mean - std).toFixed(1)}%`,
                            line: { color: '#9b59b6', width: 2, dash: 'dot' }
                        });
                    }
                    
                    // +2 standard deviations
                    if (mean + 2*std < Math.max(...data.data.bin_centers)) {
                        stdLines.push({
                            x: [mean + 2*std, mean + 2*std],
                            y: [0, maxCount],
                            type: 'scatter',
                            mode: 'lines',
                            name: `+2σ: ${(mean + 2*std).toFixed(1)}%`,
                            line: { color: '#95a5a6', width: 1, dash: 'dot' }
                        });
                    }
                    
                    const allTraces = [trace, medianLine, meanLine, ...stdLines];
                    
                    const layout = {
                        xaxis: { 
                            title: 'Distance from ATH (%)',
                            showgrid: false
                        },
                        yaxis: { 
                            title: 'Number of Days',
                            showgrid: true,
                            gridcolor: '#f0f0f0'
                        },
                        margin: { t: 20, r: 20, b: 60, l: 60 },
                        plot_bgcolor: 'white',
                        paper_bgcolor: 'white',
                        font: { family: '-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif' },
                        showlegend: true,
                        legend: { x: 0.65, y: 0.95 }
                    };
                    
                    Plotly.newPlot('distribution-chart', allTraces, layout, {responsive: true, displayModeBar: false});
                    
                    // Update insight with standard deviation explanation
                    const insight = document.getElementById('distribution-insight');
                    const insightText = document.getElementById('distribution-insight-text');
                    
                    const oneStdRange = Math.round((68/100) * 100); // ~68% of data within 1 std dev
                    const twoStdRange = Math.round((95/100) * 100); // ~95% of data within 2 std dev
                    
                    insightText.innerHTML = `The median distance from ATH is <strong>${data.data.median_distance.toFixed(1)}%</strong> - meaning half of all days, holders were down this much or more. The standard deviation lines show the "normal" ranges: about ${oneStdRange}% of days fall within 1σ (purple dotted lines) of the mean, and ${twoStdRange}% fall within 2σ. When Bitcoin is beyond the +2σ line, you're in statistically extreme territory - either euphoric highs or crushing lows.`;
                    
                    insight.style.display = 'block';
                }
            } catch (error) {
                console.error('Error loading distribution chart:', error);
            }
        }
        
        async function loadCumulativeChart() {
            try {
                const response = await fetch('/api/distribution-histogram');
                const data = await response.json();
                
                if (data.success) {
                    const trace = {
                        x: data.data.cumulative_distances,
                        y: data.data.cumulative_percentages,
                        type: 'scatter',
                        mode: 'lines',
                        name: 'Cumulative %',
                        line: { color: '#F7931A', width: 3 },
                        fill: 'tonexty',
                        fillcolor: 'rgba(247, 147, 26, 0.2)'
                    };
                    
                    let traces = [trace];
                    
                    // Add current position
                    if (currentAnalysisData) {
                        const currentDistance = currentAnalysisData.current_distance_from_ath;
                        const currentPercentile = currentAnalysisData.percentile_rank;
                        
                        const currentLine = {
                            x: [currentDistance, currentDistance],
                            y: [0, 100],
                            type: 'scatter',
                            mode: 'lines',
                            name: 'Today',
                            line: { color: '#e74c3c', width: 3, dash: 'dash' }
                        };
                        
                        const currentPoint = {
                            x: [currentDistance],
                            y: [currentPercentile],
                            type: 'scatter',
                            mode: 'markers+text',
                            name: 'You Are Here',
                            marker: { color: '#e74c3c', size: 12, symbol: 'circle' },
                            text: ['YOU ARE HERE'],
                            textposition: 'top center',
                            textfont: { size: 12, color: '#e74c3c', family: 'Arial Black' }
                        };
                        
                        traces.push(currentLine, currentPoint);
                    }
                    
                    const layout = {
                        xaxis: { 
                            title: 'Distance from ATH (%)',
                            showgrid: false
                        },
                        yaxis: { 
                            title: 'Percentage of Days (%)',
                            range: [0, 105],
                            showgrid: true,
                            gridcolor: '#f0f0f0'
                        },
                        margin: { t: 20, r: 20, b: 60, l: 60 },
                        plot_bgcolor: 'white',
                        paper_bgcolor: 'white',
                        font: { family: '-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif' },
                        showlegend: false
                    };
                    
                    Plotly.newPlot('cumulative-chart', traces, layout, {responsive: true, displayModeBar: false});
                }
            } catch (error) {
                console.error('Error loading cumulative chart:', error);
            }
        }
        
        // No time range controls needed - always show all data
        
        // Load everything when page loads
        loadAllData();
        
        // Refresh every 5 minutes
        setInterval(loadAllData, 5 * 60 * 1000);
    </script>
</body>
</html>
